<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="RmlE0E9pEoEIpffMKfGgdVUuEUchOngNmQcwRKxzydo">
  <meta name="msvalidate.01" content="0D3EC47105AF512C8387BEDF5F1CC77A">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic%7CSource+Code+Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-flash.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"papa-jun.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":"auto","version":"8.19.1","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Day 3Words and phrases for Day 3   Word Example    intimidate He tries to intimidate his rivals.   reclaim He returned three years later to reclaim his title as director of advertising.   discern I ca">
<meta property="og:type" content="article">
<meta property="og:title" content="Daily Mission">
<meta property="og:url" content="https://papa-jun.github.io/2024/01/25/Daily-Mission/index.html">
<meta property="og:site_name" content="PaPa_jun&#39;s Blog">
<meta property="og:description" content="Day 3Words and phrases for Day 3   Word Example    intimidate He tries to intimidate his rivals.   reclaim He returned three years later to reclaim his title as director of advertising.   discern I ca">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-01-25T15:36:44.000Z">
<meta property="article:modified_time" content="2024-02-01T15:36:44.000Z">
<meta property="article:author" content="YufengPeng">
<meta property="article:tag" content="Math">
<meta property="article:tag" content="DeepLearning">
<meta property="article:tag" content="English">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://papa-jun.github.io/2024/01/25/Daily-Mission/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://papa-jun.github.io/2024/01/25/Daily-Mission/","path":"2024/01/25/Daily-Mission/","title":"Daily Mission"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Daily Mission | PaPa_jun's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">PaPa_jun's Blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>Links</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a></li><li class="menu-item menu-item-works"><a href="/work/" rel="section"><i class="fa fa-inbox fa-fw"></i>Works</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Day-3"><span class="nav-number">1.</span> <span class="nav-text">Day 3</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Words-and-phrases-for-Day-3"><span class="nav-number">1.1.</span> <span class="nav-text">Words and phrases for Day 3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Listening"><span class="nav-number">1.2.</span> <span class="nav-text">Listening</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reading-for-Day-3"><span class="nav-number">1.3.</span> <span class="nav-text">Reading for Day 3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Deep-Learning-for-Day-3"><span class="nav-number">1.4.</span> <span class="nav-text">Deep Learning for Day 3</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Day-4"><span class="nav-number">2.</span> <span class="nav-text">Day 4</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Words-and-phrases-for-Day-4"><span class="nav-number">2.1.</span> <span class="nav-text">Words and phrases for Day 4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Listening-for-Day-4"><span class="nav-number">2.2.</span> <span class="nav-text">Listening for Day 4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reading-for-Day-4"><span class="nav-number">2.3.</span> <span class="nav-text">Reading for Day 4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Linear-Algebra-for-Day-4"><span class="nav-number">2.4.</span> <span class="nav-text">Linear Algebra for Day 4</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Day-5"><span class="nav-number">3.</span> <span class="nav-text">Day 5</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Words-and-phrases-for-Day-5"><span class="nav-number">3.1.</span> <span class="nav-text">Words and phrases for Day 5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Listening-for-Day-5"><span class="nav-number">3.2.</span> <span class="nav-text">Listening for Day 5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reading-for-Day-5"><span class="nav-number">3.3.</span> <span class="nav-text">Reading for Day 5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Deep-Learning-for-Day-5"><span class="nav-number">3.4.</span> <span class="nav-text">Deep Learning for Day 5</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="YufengPeng"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">YufengPeng</p>
  <div class="site-description" itemprop="description">Do not go gentle into that good night.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1BhUGEtanVu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;PaPa-jun"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOnBlbmd5dWZlbmcyMDAzQG91dGxvb2suY29t" title="E-Mail → mailto:pengyufeng2003@outlook.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://papa-jun.github.io/2024/01/25/Daily-Mission/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="YufengPeng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PaPa_jun's Blog">
      <meta itemprop="description" content="Do not go gentle into that good night.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Daily Mission | PaPa_jun's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Daily Mission
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-01-25 23:36:44" itemprop="dateCreated datePublished" datetime="2024-01-25T23:36:44+08:00">2024-01-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-01 23:36:44" itemprop="dateModified" datetime="2024-02-01T23:36:44+08:00">2024-02-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Learning/" itemprop="url" rel="index"><span itemprop="name">Learning</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="Day-3"><a href="#Day-3" class="headerlink" title="Day 3"></a>Day 3</h2><h3 id="Words-and-phrases-for-Day-3"><a href="#Words-and-phrases-for-Day-3" class="headerlink" title="Words and phrases for Day 3"></a>Words and phrases for Day 3</h3><table>
<thead>
<tr>
<th>Word</th>
<th>Example</th>
</tr>
</thead>
<tbody><tr>
<td>intimidate</td>
<td>He tries to <strong>intimidate</strong> his rivals.</td>
</tr>
<tr>
<td>reclaim</td>
<td>He returned three years later to <strong>reclaim</strong> his title as director of advertising.</td>
</tr>
<tr>
<td>discern</td>
<td>I can <strong>discern</strong> no difference between the two policies.</td>
</tr>
<tr>
<td>saturate</td>
<td>Japan’s electronics industry began to <strong>saturate</strong> the world markets.</td>
</tr>
<tr>
<td>alleviate</td>
<td>He couldn’t prevent her pain, only <strong>alleviate</strong> it.</td>
</tr>
<tr>
<td>postulate</td>
<td>The chapter was then allowed to <strong>postulate</strong> the bishop of Bath.</td>
</tr>
<tr>
<td>aggravate</td>
<td>military action would only <strong>aggravate</strong> the situation.</td>
</tr>
<tr>
<td>repel</td>
<td>Like poles <strong>repel</strong> and unlike poles attract.</td>
</tr>
<tr>
<td>mobilize</td>
<td>He used the press to <strong>mobilize</strong> support for his party.</td>
</tr>
<tr>
<td>inaugurarte</td>
<td>We <strong>inaugurate</strong> our new plant tomorrow.</td>
</tr>
<tr>
<td>immerse</td>
<td><strong>Immerse</strong> the paper in water for twenty minutes.</td>
</tr>
</tbody></table>
<ul>
<li>get the better of</li>
<li>boast of</li>
<li>take the floor</li>
<li>last but one</li>
<li>in no case</li>
<li>center one’s attention on</li>
<li>round the clock</li>
<li>commit one’s idea to writing</li>
</ul>
<h3 id="Listening"><a href="#Listening" class="headerlink" title="Listening"></a>Listening</h3><ul>
<li>Hi there. I’ve come to see the <em>flat</em>. My name is Mark Atoms, we spoke on the phone on wednesday?</li>
<li>Hi Mark, come on up. I’ll buzz you in. Green door on the second floor on the right side.<br>Nice to meet you. I spoken to all your refrences, and they all checked out ok. So let me show you around. The place actually belongs to my mother, but her health isn’t great, so we finally managed to pesuad her to move in with us, and rent this old place out.</li>
<li>It’s a great size, plenty of space., very versatile. I think it’s a winner for us.</li>
<li>Yes! All the appliances are brand new. There is a washing machine and a tumble dryer in the utility room next to the kitchen.</li>
<li>Lots of closet space too, which is fabulas! My wife has redicules number of shoes. Now, the big question: What about the noise and the neighbors?</li>
<li>Well, all the neighbors are elderly so no noisy kids and the back of the house over looks clear and pieceful pond. So it’s perfect if tran quility is what you are looking for.</li>
<li>That’s good news! We’ve been living in a less than Glamorous part of Aberdeen constently harassed day and night by noisy neighbors. Getting to work was a night mare too. As we only have one car, and my wife has to use it, as she works at nights at a hospital.</li>
<li>Well, if you like the place. It’s yours, as soon as I got the contract drawn up with the solicitor. The first month rent in a deposit are mandatory on siginning the contract. Then we can work out when is the best day for you to pay rent each month.</li>
<li>We’ll be incradibly happy to be your new tenant. Thank you so much. My wife will be therialled to get out of the shaby place we are now in. And start filling with those wardrobes with all those shoes.</li>
</ul>
<h3 id="Reading-for-Day-3"><a href="#Reading-for-Day-3" class="headerlink" title="Reading for Day 3"></a>Reading for Day 3</h3><p>The now extinct passenger pigeon has the dubious honor of being the last species anyone ever expected to disappear. At one point, there were more passenger pigeons than any other species of bird. Rough <strong><em>estimates</em></strong> of their population went as high as five billion and they accounted for around 40 percent of the total indigenous bird population of North America in the early 19th century.</p>
<p>Despite their huge population, passenger pigeons were <strong><em>vulnerable</em></strong> to human intrusion into their nesting territory. Their nests were shabby things and two weeks after the eggs <strong><em>hatched</em></strong> , the parent pigeons would abandon their offspring, leaving them to take care of themselves. People discovered that these baby pigeons were really tasty, and the adult birds were also quite <strong><em>edible</em></strong> . First the Native Americans and then the transplanted Europeans came to consider the birds a great <strong><em>delicacy</em></strong>.</p>
<p>By the 1850s, commercial trapping of passenger pigeons was proceeding at an <strong><em>unprecedented</em></strong> pace. Hundreds of thousands of the birds were being harvested every day to be made into popular pigeon pies. In addition, large <strong><em>tracts</em></strong> of the pigeons’ nesting territory were being cleared away for planting crops and creating pasture land. As numerous as the passenger pigeons were, they were not an <strong><em>infinite</em></strong> resource. By the 1880s, it was noticed that the bird population had become seriously <strong><em>depleted</em></strong>. The last passenger pigeons killed in the wild were shot in 1899.</p>
<p>Eventually those billions and billions of birds shrank to a single remaining <strong><em>specimen</em></strong> , a passenger pigeon named Martha? who died on September 1, 1914, in captivity at the Cincinnati Zoo. In addition to being the end of an era, it was also the first time humans were able to exactly time the extinction of a species.</p>
<h3 id="Deep-Learning-for-Day-3"><a href="#Deep-Learning-for-Day-3" class="headerlink" title="Deep Learning for Day 3"></a>Deep Learning for Day 3</h3><ul>
<li>Create milvusDB</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> connections, FieldSchema, CollectionSchema, DataType, Collection, utility</span><br><span class="line"></span><br><span class="line">connections.connect(<span class="string">"default"</span>, host=<span class="string">"localhost"</span>, port=<span class="string">"19530"</span>, user=<span class="string">'root'</span>, password=<span class="string">'Milvus'</span>)</span><br><span class="line">collection_name = <span class="string">'qiye_gpt'</span></span><br><span class="line"><span class="keyword">if</span> utility.has_collection(collection_name):</span><br><span class="line">    utility.drop_collection(collection_name)</span><br><span class="line">fields = [</span><br><span class="line">    FieldSchema(name=<span class="string">"id"</span>, dtype=DataType.INT64, is_primary=<span class="literal">True</span>, auto_id=<span class="literal">True</span>),</span><br><span class="line">    FieldSchema(name=<span class="string">"embedding"</span>, dtype=DataType.FLOAT_VECTOR, dim=<span class="number">1024</span>),</span><br><span class="line">    FieldSchema(name=<span class="string">"text"</span>, dtype=DataType.VARCHAR, max_length=<span class="number">8000</span>)</span><br><span class="line">]</span><br><span class="line">schema = CollectionSchema(fields, collection_name)</span><br><span class="line">collection = Collection(collection_name, schema)</span><br><span class="line">index_params = {</span><br><span class="line">    <span class="string">"index_type"</span>: <span class="string">"IVF_FLAT"</span>,</span><br><span class="line">    <span class="string">"metric_type"</span>: <span class="string">"IP"</span>,</span><br><span class="line">    <span class="string">"params"</span>: {<span class="string">"nlist"</span>: <span class="number">1024</span>},</span><br><span class="line">}</span><br><span class="line">collection.create_index(field_name=<span class="string">"embedding"</span>, index_params=index_params)</span><br><span class="line">collection.load()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"success Create collection: "</span>, collection_name)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>Extract embedding</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoTokenizer, AutoModel</span><br><span class="line"></span><br><span class="line">device = <span class="string">"cuda"</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">"cpu"</span></span><br><span class="line">tokenizer = AutoTokenizer.from_pretrained(<span class="string">'D:/qiyegpt/knowledge_augment/model/bge_large_zh_v1.5'</span>, cache_dir=<span class="string">'./model'</span>)</span><br><span class="line">model = AutoModel.from_pretrained(<span class="string">'D:/qiyegpt/knowledge_augment/model/bge_large_zh_v1.5'</span>, cache_dir=<span class="string">'./model'</span>).to(device)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mean_pooling</span>(<span class="params">model_output, attention_mask</span>):</span><br><span class="line">    token_embeddings = model_output[<span class="number">0</span>]  <span class="comment"># First element of model_output contains all token embeddings</span></span><br><span class="line">    input_mask_expanded = attention_mask.unsqueeze(-<span class="number">1</span>).expand(token_embeddings.size()).<span class="built_in">float</span>()</span><br><span class="line">    <span class="keyword">return</span> torch.<span class="built_in">sum</span>(token_embeddings * input_mask_expanded, <span class="number">1</span>) / torch.clamp(input_mask_expanded.<span class="built_in">sum</span>(<span class="number">1</span>), <span class="built_in">min</span>=<span class="number">1e-9</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_embedding</span>(<span class="params">sentences,is_insert, batch_size=<span class="number">10</span></span>):</span><br><span class="line">    <span class="keyword">if</span> is_insert:</span><br><span class="line">        res_embeddings = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(sentences), batch_size):</span><br><span class="line">            batch = sentences[i:i + batch_size]</span><br><span class="line">            encoded_input = tokenizer(batch, padding=<span class="literal">True</span>, truncation=<span class="literal">True</span>,</span><br><span class="line">                                  max_length=<span class="number">512</span>, return_tensors=<span class="string">'pt'</span>).to(device)</span><br><span class="line">            <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">                model_output = model(**encoded_input)</span><br><span class="line">            <span class="comment"># Perform pooling. In this case, mean pooling.</span></span><br><span class="line">            sentence_embeddings = mean_pooling(model_output, encoded_input[<span class="string">'attention_mask'</span>])</span><br><span class="line">            sentence_embeddings_norm = sentence_embeddings / sentence_embeddings.norm(p=<span class="number">2</span>, dim=-<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">            <span class="comment">#sentence_embeddings_norm = sentence_embeddings_norm.squeeze(0)</span></span><br><span class="line">            sentence_embeddings_norm = sentence_embeddings_norm.cpu().detach().numpy().tolist()</span><br><span class="line">            res_embeddings.extend(sentence_embeddings_norm)</span><br><span class="line">        <span class="keyword">return</span> res_embeddings</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        encoded_input = tokenizer(sentences, padding=<span class="literal">True</span>, truncation=<span class="literal">True</span>,</span><br><span class="line">                                 max_length=<span class="number">512</span>, return_tensors=<span class="string">'pt'</span>).to(device)</span><br><span class="line">        <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">            model_output = model(**encoded_input)</span><br><span class="line">        <span class="comment"># Perform pooling. In this case, mean pooling.</span></span><br><span class="line">        sentence_embeddings = mean_pooling(model_output, encoded_input[<span class="string">'attention_mask'</span>])</span><br><span class="line">        sentence_embeddings_norm = sentence_embeddings / sentence_embeddings.norm(p=<span class="number">2</span>, dim=-<span class="number">1</span>, keepdim=<span class="literal">True</span>)</span><br><span class="line">        sentence_embeddings_norm = sentence_embeddings_norm.squeeze(<span class="number">0</span>)</span><br><span class="line">        sentence_embeddings_norm = sentence_embeddings_norm.cpu().detach().numpy().tolist()</span><br><span class="line">        <span class="keyword">return</span> sentence_embeddings_norm</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>Insert_db</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> connections, Collection</span><br><span class="line"><span class="comment"># from pdf_load import extract_text_from_pdf</span></span><br><span class="line"><span class="keyword">from</span> extract_embedding <span class="keyword">import</span> get_embedding</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_all_files_in_folder</span>(<span class="params">folder_path</span>):</span><br><span class="line">    file_paths = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(folder_path):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> files:</span><br><span class="line">            file_paths.append(os.path.join(root, file))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> file_paths</span><br><span class="line"></span><br><span class="line">folder_path = <span class="string">"D:/qiyegpt/knowledge_augment/data"</span></span><br><span class="line">file_paths = get_all_files_in_folder(folder_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">connections.connect(<span class="string">"default"</span>, host=<span class="string">"localhost"</span>, port=<span class="string">"19530"</span>, user=<span class="string">'root'</span>, password=<span class="string">'Milvus'</span>)</span><br><span class="line">collection_name = <span class="string">'qiye_gpt'</span></span><br><span class="line">collection = Collection(collection_name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># def InsertDb_pdf(filepath):</span></span><br><span class="line"><span class="comment">#     docs = extract_text_from_pdf(filepath)</span></span><br><span class="line"><span class="comment">#     #sentences = [i.page_content for i in docs]</span></span><br><span class="line"><span class="comment">#     embeddings = get_embedding(docs, is_insert=True, batch_size=10)</span></span><br><span class="line"><span class="comment">#     mr = collection.insert([embeddings,docs])</span></span><br><span class="line"><span class="comment">#     collection.flush()</span></span><br><span class="line"><span class="comment">#     print('提取特征并存放ai数据库', mr.succ_count)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># def Insert_json(filepath):</span></span><br><span class="line"><span class="comment">#     with open(filepath, "r", encoding="utf-8") as f:</span></span><br><span class="line"><span class="comment">#         data = json.load(f)</span></span><br><span class="line"><span class="comment">#         temp = []</span></span><br><span class="line"><span class="comment">#         for i in data:</span></span><br><span class="line"><span class="comment">#             if len(i["content"]) != 0:</span></span><br><span class="line"><span class="comment">#                 temp.append(i["name"] + ":" + i["content"])</span></span><br><span class="line"><span class="comment">#             for j in i["subsections"]:</span></span><br><span class="line"><span class="comment">#                 if j["name"] in i["name"]:</span></span><br><span class="line"><span class="comment">#                     temp.append(j["name"] + ":" + j["content"])</span></span><br><span class="line"><span class="comment">#                 else:</span></span><br><span class="line"><span class="comment">#                     temp.append(i["name"] + j["name"] + ":" + j["content"])</span></span><br><span class="line"><span class="comment">#         embeddings = get_embedding(temp, is_insert=True, batch_size=10)</span></span><br><span class="line"><span class="comment">#         mr = collection.insert([embeddings, temp])</span></span><br><span class="line"><span class="comment">#         collection.flush()</span></span><br><span class="line"><span class="comment">#         print('提取特征并存放ai数据库', mr.succ_count)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Insert_json</span>(<span class="params">filepath</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">"r"</span>, encoding=<span class="string">"utf-8"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = json.load(f)</span><br><span class="line"></span><br><span class="line">        name = []</span><br><span class="line">        content = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">            name.append(i[<span class="string">"name"</span>])</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(i[<span class="string">"content"</span>]) &gt; <span class="number">1500</span>:</span><br><span class="line">                content.append((i[<span class="string">"name"</span>] + <span class="string">":"</span> + i[<span class="string">"content"</span>][:<span class="number">1500</span>]))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                content.append(i[<span class="string">"name"</span>] + <span class="string">":"</span> + i[<span class="string">"content"</span>])</span><br><span class="line">        embeddings = get_embedding(name, is_insert=<span class="literal">True</span>, batch_size=<span class="number">10</span>)</span><br><span class="line">        mr = collection.insert([embeddings, content])</span><br><span class="line">        collection.flush()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'提取特征并存放ai数据库'</span>, mr.succ_count)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># InsertDb_pdf('中科大不完全入学指南.pdf')</span></span><br><span class="line"><span class="keyword">for</span> path <span class="keyword">in</span> file_paths:</span><br><span class="line">    Insert_json(path)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">'读取完成'</span>)</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>newapp</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> transformers <span class="keyword">import</span> AutoModel, AutoTokenizer</span><br><span class="line"><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</span><br><span class="line"><span class="keyword">from</span> streamlit_chat <span class="keyword">import</span> message</span><br><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> connections, FieldSchema, CollectionSchema, DataType, Collection, utility</span><br><span class="line"><span class="keyword">from</span> search_db <span class="keyword">import</span> GeneratePrompt</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">connections.connect(<span class="string">"default"</span>, host=<span class="string">"localhost"</span>, port=<span class="string">"19530"</span>, user=<span class="string">'root'</span>, password=<span class="string">'Milvus'</span>)</span><br><span class="line">collection_name = <span class="string">'qiye_gpt'</span></span><br><span class="line">collection = Collection(collection_name)</span><br><span class="line"></span><br><span class="line">st.set_page_config(</span><br><span class="line">    page_title=<span class="string">"企业gpt 演示"</span>,</span><br><span class="line">    page_icon=<span class="string">":robot:"</span>,</span><br><span class="line">    layout=<span class="string">'wide'</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">alter_format</span>(<span class="params">string</span>):</span><br><span class="line">    quanjiao=[ <span class="string">'｀'</span>, <span class="string">'”'</span>, <span class="string">'’'</span>, <span class="string">'“'</span>, <span class="string">'‘'</span>, <span class="string">'＿'</span>, <span class="string">'－'</span>,</span><br><span class="line">     <span class="string">'～'</span>, <span class="string">'＝'</span>, <span class="string">'＋'</span>,  <span class="string">'｜'</span>,  <span class="string">'（'</span>, <span class="string">'）'</span>, <span class="string">'［'</span>, <span class="string">'］'</span>, <span class="string">'【'</span>, <span class="string">'】'</span>, <span class="string">'｛'</span>, <span class="string">'｝'</span>, <span class="string">'＜'</span>, <span class="string">'＞'</span>,  <span class="string">'，'</span>, <span class="string">'；'</span>,  <span class="string">'！'</span>, <span class="string">'＾'</span>, <span class="string">'％'</span>,</span><br><span class="line">     <span class="string">'＃'</span>, <span class="string">'＠'</span>, <span class="string">'＄'</span>, <span class="string">'＆'</span>, <span class="string">'？'</span>, <span class="string">'＊'</span>]</span><br><span class="line">    banjiao=[<span class="string">'`'</span>, <span class="string">'"'</span>, <span class="string">"'"</span>, <span class="string">'"'</span>, <span class="string">"'"</span>, <span class="string">'_'</span>, <span class="string">'-'</span>,</span><br><span class="line">     <span class="string">'~'</span>, <span class="string">'='</span>, <span class="string">'+'</span>,  <span class="string">'|'</span>,  <span class="string">'('</span>, <span class="string">')'</span>, <span class="string">'['</span>, <span class="string">']'</span>, <span class="string">'['</span>, <span class="string">']'</span>, <span class="string">'{'</span>, <span class="string">'}'</span>, <span class="string">'&lt;'</span>, <span class="string">'&gt;'</span>,  <span class="string">','</span>, <span class="string">';'</span>, <span class="string">'!'</span>, <span class="string">'^'</span>, <span class="string">'%'</span>,</span><br><span class="line">     <span class="string">'#'</span>, <span class="string">'@'</span>, <span class="string">'$'</span>, <span class="string">'&amp;'</span>, <span class="string">'?'</span>, <span class="string">'*'</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(string)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(banjiao)):</span><br><span class="line">            <span class="keyword">if</span> string[i]==banjiao[j]:</span><br><span class="line">                string = string.replace(string[i], quanjiao[j], <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> string</span><br><span class="line"></span><br><span class="line"><span class="meta">@st.cache_resource</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_model</span>():</span><br><span class="line">    device = <span class="string">"cuda"</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">"cpu"</span></span><br><span class="line">    tokenizer = AutoTokenizer.from_pretrained(</span><br><span class="line">        <span class="string">"D:/qiyegpt/knowledge_augment/model/chatglm2-6b"</span>, trust_remote_code=<span class="literal">True</span>)</span><br><span class="line">    model = AutoModel.from_pretrained(</span><br><span class="line">        <span class="string">"D:/qiyegpt/knowledge_augment/model/chatglm2-6b"</span>, trust_remote_code=<span class="literal">True</span>) \</span><br><span class="line">        .half().quantize(<span class="number">4</span>).to(device)</span><br><span class="line">    model = model.<span class="built_in">eval</span>()</span><br><span class="line">    <span class="keyword">return</span> tokenizer, model</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">new_click</span>():</span><br><span class="line">    st.session_state[<span class="string">'show_history'</span>] = []</span><br><span class="line">    st.session_state[<span class="string">'input_history'</span>] = []</span><br><span class="line">    st.session_state[<span class="string">'past_key_values'</span>] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tokenizer, model = get_model()</span><br><span class="line"></span><br><span class="line">st.title(<span class="string">"企业-GPT"</span>)</span><br><span class="line"></span><br><span class="line">max_length = st.sidebar.slider(</span><br><span class="line">    <span class="string">'max_length'</span>, <span class="number">0</span>, <span class="number">32768</span>, <span class="number">8192</span>, step=<span class="number">1</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># top_p = st.sidebar.slider(</span></span><br><span class="line"><span class="comment">#     'top_p', 0.0, 1.0, 0.8, step=0.01</span></span><br><span class="line"><span class="comment"># )</span></span><br><span class="line">top_k = st.sidebar.slider(</span><br><span class="line">    <span class="string">'top_k'</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">1</span>, step=<span class="number">1</span></span><br><span class="line">)</span><br><span class="line">temperature = st.sidebar.slider(</span><br><span class="line">    <span class="string">'temperature'</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.8</span>, step=<span class="number">0.01</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">'show_history'</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state:</span><br><span class="line">    st.session_state.show_history = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">'input_history'</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state:</span><br><span class="line">    st.session_state.input_history = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">'past_key_values'</span> <span class="keyword">not</span> <span class="keyword">in</span> st.session_state:</span><br><span class="line">    st.session_state.past_key_values = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">button2 = st.button(<span class="string">"重新发起对话"</span>, key=<span class="string">"delete"</span>)</span><br><span class="line"><span class="keyword">if</span> button2:</span><br><span class="line">    new_click()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, (query, response) <span class="keyword">in</span> <span class="built_in">enumerate</span>(st.session_state.show_history):</span><br><span class="line">    <span class="keyword">with</span> st.chat_message(name=<span class="string">"user"</span>, avatar=<span class="string">"user"</span>):</span><br><span class="line">        st.markdown(query)</span><br><span class="line">    <span class="keyword">with</span> st.chat_message(name=<span class="string">"assistant"</span>, avatar=<span class="string">"assistant"</span>):</span><br><span class="line">        st.markdown(response)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> st.chat_message(name=<span class="string">"user"</span>, avatar=<span class="string">"user"</span>):</span><br><span class="line">    input_placeholder = st.empty()</span><br><span class="line"><span class="keyword">with</span> st.chat_message(name=<span class="string">"assistant"</span>, avatar=<span class="string">"assistant"</span>):</span><br><span class="line">    message_placeholder = st.empty()</span><br><span class="line"></span><br><span class="line">prompt_text = st.text_area(label=<span class="string">"用户输入"</span>,</span><br><span class="line">                           height=<span class="number">100</span>,</span><br><span class="line">                           placeholder=<span class="string">"请在这儿输入您的问题"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">button1 = st.button(<span class="string">"发送"</span>, key=<span class="string">"predict"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> button1:</span><br><span class="line">    input_placeholder.markdown(prompt_text)</span><br><span class="line">    input_history, show_history, past_key_values = st.session_state.input_history, st.session_state.show_history,\</span><br><span class="line">        st.session_state.past_key_values</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(show_history) == <span class="number">0</span>:</span><br><span class="line">        query = GeneratePrompt(prompt_text, top_k)</span><br><span class="line">        <span class="built_in">print</span>(query)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        query = prompt_text</span><br><span class="line">        <span class="built_in">print</span>(query)</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    top_p = <span class="number">0.8</span></span><br><span class="line">    <span class="comment"># for response, input_history, past_key_values in model.stream_chat(tokenizer, query, input_history,</span></span><br><span class="line">    <span class="comment">#                                                             past_key_values=past_key_values,</span></span><br><span class="line">    <span class="comment">#                                                             max_length=max_length, top_p=top_p,</span></span><br><span class="line">    <span class="comment">#                                                             temperature=temperature,</span></span><br><span class="line">    <span class="comment">#                                                             return_past_key_values=True):</span></span><br><span class="line">    out = model.stream_chat(tokenizer, query, input_history,</span><br><span class="line">                                                                past_key_values=past_key_values,</span><br><span class="line">                                                                max_length=max_length, top_p=top_p,</span><br><span class="line">                                                                temperature=temperature,</span><br><span class="line">                                                                return_past_key_values=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> response, input_history, past_key_values <span class="keyword">in</span> out:</span><br><span class="line">        response = alter_format(response)</span><br><span class="line">        message_placeholder.markdown(response)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="comment"># print(type(past_key_values))</span></span><br><span class="line">    <span class="comment"># print(past_key_values)</span></span><br><span class="line">    st.session_state.input_history = input_history</span><br><span class="line">    st.session_state.show_history = show_history + [(prompt_text, input_history[-<span class="number">1</span>][<span class="number">1</span>])]</span><br><span class="line">    st.session_state.past_key_values = past_key_values</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>Requirements</li>
</ul>
<figure class="highlight txt"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cpm_kernels==1.0.11</span><br><span class="line">pandas==2.0.3</span><br><span class="line">pymilvus==2.2.14</span><br><span class="line">sentencepiece==0.1.99</span><br><span class="line">streamlit==1.25.0</span><br><span class="line">streamlit_chat==0.1.1</span><br><span class="line">torch==2.0.1+cu117</span><br><span class="line">transformers==4.31.0</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>Search Db</li>
</ul>
<figure class="highlight py"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> extract_embedding <span class="keyword">import</span> get_embedding</span><br><span class="line"><span class="keyword">from</span> pymilvus <span class="keyword">import</span> connections, Collection</span><br><span class="line"></span><br><span class="line">connections.connect(<span class="string">"default"</span>, host=<span class="string">"localhost"</span>, port=<span class="string">"19530"</span>, user=<span class="string">'root'</span>, password=<span class="string">'Milvus'</span>)</span><br><span class="line">collection_name = <span class="string">'qiye_gpt'</span></span><br><span class="line">collection = Collection(collection_name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SearchDb</span>(<span class="params">query_str:<span class="built_in">str</span>, topk=<span class="number">5</span></span>):</span><br><span class="line">    <span class="comment">#输入问题，ai数据库中返回topk个相近的答案</span></span><br><span class="line">    collection.load()</span><br><span class="line">    search_params = {<span class="string">"metric_type"</span>: <span class="string">"IP"</span>, <span class="string">"params"</span>: {<span class="string">"nprobe"</span>: <span class="number">64</span>}}</span><br><span class="line">    embedding = get_embedding(query_str,is_insert=<span class="literal">False</span>)</span><br><span class="line">    results = collection.search(</span><br><span class="line">        data=[embedding],</span><br><span class="line">        anns_field=<span class="string">"embedding"</span>,</span><br><span class="line">        param=search_params,</span><br><span class="line">        limit=topk,</span><br><span class="line">        output_fields=[<span class="string">"text"</span>]</span><br><span class="line">    )</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> hits <span class="keyword">in</span> results:</span><br><span class="line">        <span class="keyword">for</span> hit <span class="keyword">in</span> hits:</span><br><span class="line">            score = <span class="built_in">round</span>(hit.distance, <span class="number">3</span>)</span><br><span class="line">            <span class="keyword">if</span> score &gt;= <span class="number">0.2</span>:</span><br><span class="line">                res.append({</span><br><span class="line">                    <span class="string">"score"</span>: score,</span><br><span class="line">                    <span class="string">"text"</span>: hit.entity.get(<span class="string">'text'</span>)</span><br><span class="line">                })</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Successfully searched similar texts!"</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GeneratePrompt</span>(<span class="params">query: <span class="built_in">str</span>,topk</span>):</span><br><span class="line">    <span class="comment"># 基于上下文的prompt模版，请务必保留"{question}"和"{context}"</span></span><br><span class="line">    related_docs = SearchDb(query, topk)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(related_docs)&gt;<span class="number">0</span>:</span><br><span class="line">        PROMPT_TEMPLATE = <span class="string">"""已知信息：</span></span><br><span class="line"><span class="string">        {context}</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        上述各条信息之间不存在关联，根据上述已知信息，来回答用户的问题。如果上述信息没提到相关问题，请拒绝回答。问题是：{question}"""</span></span><br><span class="line">        <span class="comment"># context = "\n".join([doc['text'] for doc in related_docs])</span></span><br><span class="line">        <span class="comment"># prompt = PROMPT_TEMPLATE.replace("{question}", query).replace("{context}", context)</span></span><br><span class="line">        context = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> i, doc <span class="keyword">in</span> <span class="built_in">enumerate</span>(related_docs):</span><br><span class="line">            context += <span class="string">"\n信息"</span> + <span class="built_in">str</span>(i + <span class="number">1</span>) +<span class="string">":"</span>+ doc[<span class="string">"text"</span>]</span><br><span class="line">        prompt = PROMPT_TEMPLATE.replace(<span class="string">"{question}"</span>, query).replace(<span class="string">"{context}"</span>, context)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        prompt = query</span><br><span class="line">    <span class="built_in">print</span>(prompt)</span><br><span class="line">    <span class="keyword">return</span> prompt</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Day-4"><a href="#Day-4" class="headerlink" title="Day 4"></a>Day 4</h2><h3 id="Words-and-phrases-for-Day-4"><a href="#Words-and-phrases-for-Day-4" class="headerlink" title="Words and phrases for Day 4"></a>Words and phrases for Day 4</h3><table>
<thead>
<tr>
<th>Word</th>
<th>Example</th>
</tr>
</thead>
<tbody><tr>
<td>manipulate</td>
<td>He <strong>manipulates</strong> people.</td>
</tr>
<tr>
<td>contend</td>
<td>It is time, once again, to <strong>contend</strong> with racism.</td>
</tr>
<tr>
<td>refrain</td>
<td>Mrs Hardie <strong>refrained</strong> from making any comment.</td>
</tr>
<tr>
<td>mediate</td>
<td>My mom was the one who <strong>mediated</strong> between Zelda and her mom.</td>
</tr>
<tr>
<td>conform</td>
<td><strong>Conform</strong> to sth.</td>
</tr>
</tbody></table>
<ul>
<li>keep company with</li>
<li>compare… with…</li>
<li>compare… to…</li>
<li>by comparison</li>
<li>comply with</li>
<li>concentrate on</li>
<li>at the conclusion of</li>
<li>condemn sb. to</li>
<li>in that</li>
<li>now that</li>
<li>for all that</li>
<li>confess to</li>
<li>confide in</li>
<li>in confidence</li>
<li>confine to</li>
<li>be confront with</li>
<li>consent to</li>
</ul>
<h3 id="Listening-for-Day-4"><a href="#Listening-for-Day-4" class="headerlink" title="Listening for Day 4"></a>Listening for Day 4</h3><p>A new study has found a positive <em>corlation</em> between how much television children whatch and their parents’ stress levels. Why? Because the more television children watch the more they are exposed to advertizing. The more advertizement they see, the more likely they are to insist on purchesing items when they go with their parents to stores. This could generate conflict if the parents refuse. All that reshercher say can contribute to parents overall stress levels. Whats the solution? Perhaps the most obvius is to <em>curtenling</em> screen time. Conmercial content is there for a reason to a <em>lisen</em> purchasing behavier. So parents might want to shut off the TV. Researchers <em>conseed</em> that this is easier said than done. So they suggest another option. Parents can change how they talk to their kids about purchases. The researchers suggest that parents seek <em>inpact</em> from their children on family purchasing decisions. They shouldn’t try to control all purchases. Instead, parents might tell their children things like “I will listen to your advise on some certain products or brands.” This type of conmunication the reserchers assert can lead children making fewer purchasing demends. That means less parents stress. However the protective of affect of this kind of conmunication <em>deminishis</em> with greater exposure to television. This is because advertizing <em>inda</em> children is a specialy persuasive. Advertizers use a <em>sortment</em> of technics such as bright colors, happy music and cerleberty <em>indosment</em> to appeal to children. Plus, children don’t have the <em>cogneti</em> ability to fully understand advertizing <em>is intent</em>. That makes them perticularly vulnerable to advertisements.</p>
<h3 id="Reading-for-Day-4"><a href="#Reading-for-Day-4" class="headerlink" title="Reading for Day 4"></a>Reading for Day 4</h3><ul>
<li>sought-after</li>
<li>keep up</li>
<li>constraint</li>
<li>enrollment</li>
<li>bill</li>
<li>university admission</li>
<li>amended</li>
<li>admission purpose</li>
<li>well-rounded</li>
<li>correlate</li>
<li>mutual respect</li>
<li>resume</li>
</ul>
<h3 id="Linear-Algebra-for-Day-4"><a href="#Linear-Algebra-for-Day-4" class="headerlink" title="Linear Algebra for Day 4"></a>Linear Algebra for Day 4</h3><h2 id="Day-5"><a href="#Day-5" class="headerlink" title="Day 5"></a>Day 5</h2><h3 id="Words-and-phrases-for-Day-5"><a href="#Words-and-phrases-for-Day-5" class="headerlink" title="Words and phrases for Day 5"></a>Words and phrases for Day 5</h3><table>
<thead>
<tr>
<th>Word</th>
<th>Expamles</th>
</tr>
</thead>
</table>
<h3 id="Listening-for-Day-5"><a href="#Listening-for-Day-5" class="headerlink" title="Listening for Day 5"></a>Listening for Day 5</h3><h3 id="Reading-for-Day-5"><a href="#Reading-for-Day-5" class="headerlink" title="Reading for Day 5"></a>Reading for Day 5</h3><h3 id="Deep-Learning-for-Day-5"><a href="#Deep-Learning-for-Day-5" class="headerlink" title="Deep Learning for Day 5"></a>Deep Learning for Day 5</h3>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Math/" rel="tag"><i class="fa fa-tag"></i> Math</a>
              <a href="/tags/DeepLearning/" rel="tag"><i class="fa fa-tag"></i> DeepLearning</a>
              <a href="/tags/English/" rel="tag"><i class="fa fa-tag"></i> English</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/01/12/An%20assembler%20for%20LC-3/" rel="prev" title="An assembler for LC-3">
                  <i class="fa fa-angle-left"></i> An assembler for LC-3
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/01/28/retrieval-augmented-generation-rag/" rel="next" title="Retrieval Augmented Generation (RAG)">
                  Retrieval Augmented Generation (RAG) <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">YufengPeng</span>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  <script src="/js/third-party/pace.js"></script>


  





</body>
</html>
